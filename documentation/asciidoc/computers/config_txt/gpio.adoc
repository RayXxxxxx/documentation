[[gpio-control]]
== GPIO控制

[[gpio]]
=== `gpio` 

通过 `gpio` 指令，可以在启动时将 GPIO 引脚设置为特定模式和值，而以前需要自定义 `dt-blob.bin` 文件。每一行都对一组引脚应用相同的设置（或至少进行相同的更改），可以是单个引脚（`3`）、引脚范围（`3-4`）或以逗号分隔的列表（`3-4,6,8`）。
引脚集后面跟一个 `=` 和一个或多个以逗号分隔的属性：

* `ip` - 输入
* `op` - 输出
* `a0-a5` - Alt0-Alt5
* `dh` - 驱动高电平（用于输出）
* `dl` - 驱动低电平（用于输出）
* `pu` - 上拉
* `pd` - 下拉
* `pn/np` - 没有上拉或下拉

`gpio` 设置按顺序应用，因此后面出现的设置会覆盖之前出现的设置。

例子：

[source,ini]
----
# 为GPIO引脚0到27选择Alt2（对于DPI24）
gpio=0-27=a2

# 将GPIO12设置为输出设置为1
gpio=12=op,dh

# 改变拉动（输入）引脚18和20
gpio=18,20=pu

# 设置引脚17到21为输入
gpio=17-21=ip
----

`gpio` 指令受控于 `config.txt` 中的 `[...]` 条件筛选器，因此可以根据型号、序列号和 EDID 使用不同的设置。

通过这种机制进行的 GPIO 更改不会对内核产生任何直接影响。它们不会导致 GPIO 引脚被导出到 `sysfs` 接口，而且可以被设备树中的 `pinctrl` 条目以及 `pinctrl` 等实用程序覆盖。

还需注意的是，从接通电源到更改生效之间会有几秒钟的延迟，如果通过网络或 USB 大容量存储设备启动，延迟时间会更长。

